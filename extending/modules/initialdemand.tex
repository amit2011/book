% ####################################################################################################
\section{Generation of the initial \gls{matsim} input files}

As stated in Section~\ref{sec:buildingbasicscenario}, the minimal \gls{matsim} input, besides the configuration, consists of the network and the population/initial plans file.  For illustrative scenarios, all three can be generated with a text editor.  For more complicated and/or realistic scenarios, they need to be generated by other methods.  People with knowledge in a scripting language may use that scripting languate to generate the necessary \gls{xml} files, possibly honoring the \gls{matsim} \glspl{dtd}.  We ourselves use \gls{java} as our scripting language for these purposes.  \gls{java} is not necessarily the best language for this purpose; this may be discussed elsewhere.  We use it anyways, for the following reasons:
\begin{itemize}

\item Most of us also program \gls{matsim} extensions, and these currently have to be in \gls{java}.  Thus, using \gls{java} as a scripting language for initial input generation saves us the effort of becoming proficient in another programming language.

\item The \gls{matsim} software, by necessity, already contains all the necessary file readers and writers that are necessary to generate \gls{matsim} input.  In consequence, one saves the effort of re-implementing them, and one automatically moves forward with file version updates.  Additionally, one can directly use the \gls{matsim} data containers.

\item Once one starts writing \gls{matsim} scripts-in-\gls{java} (Section~\ref{sec:writing-scripts-java}), in many situations it makes sense to modify the data after reading the input files.  The programming techniques for this are the same as for other initial input generation.

\end{itemize}

\subsection{Initial Demand Generation}
\label{sec:extending-initial-demand}

\kaitodo{chk initial demand generation section}

Section~\ref{sec:buildingbasicscenario} introduced the elements
required for a basic \gls{matsim} scenario.  Part~IV will show how
initial demand was generated on a practical level---discussing, \eg
the different types of original input data---for different scenarios.
This section presents \gls{matsim}'s technical tools for initial
demand generation.


Different from the single modules' description of the previous sections of this chapter, here, functionality is achieved by combining different modules. 

Entry point are following parsimonious example scripts, which can be adapted to generate the initial demand for a specific geographical region. The scripts can be found in package \lstinline|tutorial.programming.example08DemandGeneration|; alternatively, see \url{http://matsim.org/javadoc} $\to$ core:
\begin{lstlisting}
class RunPNetworkGenerator
\end{lstlisting} 
generating a \gls{matsim} network derived from \gls{osm}, and
\begin{lstlisting}
class RunPOnePersonPopulationGenerator, 
class RunPPopulationGenerator
\end{lstlisting}
generating a one agent and a 20\,agents population, respectively, and writing them to files, and, 
\begin{lstlisting}
class RunZPopulationGenerator
\end{lstlisting} 
generating a sample population from a census file and writing it to a file.

\kai{folgendes ist irgendwie immer noch unsortiert.  Vielleicht besser irgendwo anders beschreiben?}

These ``scripts'' build on utility classes such as \lstinline|class PopulationUtils| providing factory functionality 
%by public and static methods 
%Im Java-Sinne sind die m.E. nicht statcs, aber eigentlich tut es auch nichts zur Sache. kai, apr'15
to create and manipulate elements of the module containing respective utility class. \lstinline|PopulationUtils| for example has a \lstinline|createPopulation(...)| method.

Utility classes are usually named \lstinline|*Utils|. 
Following utils exist
\lstinline|ConfigUtils|,
\lstinline|NetworkUtils|,
\lstinline|PopulationUtils|,
\lstinline|ScenarioUtils|,
\lstinline|ControlerUtils|,
\lstinline|FacilitiesUtils|,
\lstinline|VehicleUtils|,
%
\lstinline|EventsUtils|,
\lstinline|CharyparNagelScoringUtils|,
\lstinline|LanesUtils|,
\lstinline|QSimUtils|,
%
\lstinline|SignalUtils|,
\lstinline|TripStructureUtils|,
(\lstinline|ObjectAttributesUtils|), and
(\lstinline|VectorUtils|).
Furthermore, there are geometry factories contained in package \lstinline|geometry|, such as \lstinline|TransformationFactory|.

%%\kaitodo{we need something about how to use extensions}
% this is in ``Using One or More Contribs''. kai, jul'15

% ####################################################################################################
%\subsubsection{Utils}
%\ah{
%This is maybe better somewhere in Chapter~\ref{ch:extensionpoints}.
%They are not really extension points but something similar helpful for scripting.
%}
%%
%\kai{I would (strongly) vote for Chapter~\ref{ch:extensionpoints}.  ``writing scripts in java'' is a forward reference, and details should go to where it points to.  It is indeed not an ``extension point'', but something like an ``extension programming survival tool''.}

%\ah{moved this up}

% ----------------------------------------------------------------

%\kai{
%Hallo Andreas,
 %
 %Haben wir irgendwo im Buch etwas ueber ``initial input generation'' (also network.xml und plans.xml)?
 %
 %Ich finde etwas in 2.2, aber das war es dann auch.
 %
 %Irgendwie finde ich aber doch, dass wir wenigstens minimale Hinweise auf
 %
 %RunPNetworkGenerator
 %RunPOnePersonPopulationGenerator
 %
 %geben sollten.
 %
 %M.E. sind das auch ``scripts-in-java'', und damit auch Kap.32.
 %
 %Das waere dann m.E. noch vor 32.2.1, also neu
 %
 %32.2.1 initial demand generation
 %
 %32.2.2 config group
 %
 %Oder?
 %
 %VG Kai
%}
%
%\ah{Stimmt. Ich hatte frueher auch mal Kirills Popgen auf dem Schirm, dann aber Initial Demand Generation irgendwie etwas verdraengt, weil es inhaltlich durch die Szenarien abgedeckt ist. Technisch aber natuerlich nicht, werde mich die naechsten Tage daran versuchen.
%}
%
%\kai{
%Danke.  M.E. kann das eher kurz sein, mit Verweis auf die Beispiele.
%
%Ist aber der Ort, wo (m.E.) die Factories erklaert werden muessen.
%
%VG
%
%Kai
%}

% Local Variables:
% mode: latex
% mode: reftex
% mode: visual-line
% TeX-master: "../../main"
% comment-padding: 1
% fill-column: 9999
% End: 
